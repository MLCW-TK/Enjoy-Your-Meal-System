package orders;

import customutilities.CustomUtilities;
import ingredients.Ingredient;
import mealsystem.*;
import users.User;

import java.text.DecimalFormat;
import java.util.*;

import cardfidelitysystem.BasicFidelityCard;
import cardfidelitysystem.LotteryFidelityCard;
import cardfidelitysystem.PointFidelityCard;

public class Order{
	private DecimalFormat df = new DecimalFormat("#.00"); 
	private ArrayList<AbstractMeal> unprocessedOrders;
	private double total_transaction;
	private ArrayList<AbstractMeal> savedOrders;
	private ArrayList<AbstractMeal> editedOrders;
	/**
	 * Constructor Order
	 */
	public Order(){
		this.unprocessedOrders = new ArrayList<AbstractMeal>();
		this.savedOrders = new ArrayList<AbstractMeal>();
		this.editedOrders = new ArrayList<AbstractMeal>();
	}
	
	public void saveOrder(){
		this.savedOrders.addAll(unprocessedOrders);
		for (AbstractMeal meal : savedOrders){
			total_transaction += meal.getPrice();
		}

		this.savedOrders.addAll(editedOrders);
		for (AbstractMeal meal : savedOrders){
			total_transaction += meal.getPrice();
		}
	}
	
	public ArrayList<AbstractMeal> getSavedOrder(){
		return this.savedOrders;
	}
	
	public void addPersonalizedMeal(AbstractMeal meal){
		this.editedOrders.add(meal);
	}
	
	public void selectMeal(AbstractMeal meal, int count){
		for (int i = 0; i < count; i++){
			unprocessedOrders.add(meal);	
		}
	}
	
	public ArrayList<AbstractMeal> getUnprocessedOrders(){
		return unprocessedOrders;
	}
	
	public AbstractMeal personalizeMeal(AbstractMeal meal, Ingredient ingredient, int quantity){
		// If meal already contains ingredient
		if (meal.getIngredients().contains(ingredient)){
			// if we set the quantity = 0, means he wants to remove the ingredient
			if (quantity == 0){

				Meal newinstance = (Meal) meal.createNewInstance();
				newinstance.setBehavior(new RemoveIngredient());
				newinstance.executeBehavior(ingredient, 0);
				newinstance.setPersonalizedBool(true);
				return newinstance;
			} else {
				Meal newinstance = (Meal) meal.createNewInstance();
				Ingredient new_ingredient = ingredient.createnewinstance();
				new_ingredient.setQuantity(new_ingredient.getOriginalQuantity()+quantity);
				newinstance.getIngredients().remove(ingredient);
				newinstance.getIngredients().add(new_ingredient);
				newinstance.setPersonalizedBool(true);
				return newinstance;
//				meal.setBehavior(new ChangeIngredient());
//				meal.executeBehavior(ingredient, quantity);
			}
		} else {

			Meal newinstance = (Meal) meal.createNewInstance();
			newinstance.setBehavior(new AddIngredient());
			newinstance.executeBehavior(ingredient, quantity);
			newinstance.setPersonalizedBool(true);
			return newinstance;
		}
	}
	
	public double getTotalTransaction(){return this.total_transaction;}
	
	/**
	 * Prints out a string containing the summary of orders saved
	 */
	public String Summary(){
		String s = new String();
		for (AbstractMeal obj : this.getSavedOrder()){
			s += obj.getName() + " " + obj.getIngredientsString() + ", $" + obj.getStringPrice();
			s += "\n";
		}
		s += "Total price: " + df.format(total_transaction);
		return s;
	}
	
	

	

}
